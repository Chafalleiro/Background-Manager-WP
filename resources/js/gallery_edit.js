/*
 * Copyright (c) 2011 Mike Green <myatus@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 */
(function(a){photo_selection=new Object();getPhotoCount=function(){return getAjaxData("photo_count",a("#edit_id").val())};getPhotosHash=function(){return getAjaxData("photos_hash",a("#edit_id").val())};getPhotoIds=function(){return getAjaxData("photo_ids",a("#edit_id").val())};removePhotosOverlay=function(){a("#photos_iframe").fadeIn("fast",function(){a("#photo_iframe_overlay").hide()})};showHideEditBar=function(c){if(c==true){var d=getPhotoIds();for(key in photo_selection){var g=key.replace("photo_","");if(d[g]==undefined){delete photo_selection[key]}}}var f=a("#quicktags"),b=a("#selected-count"),e=getObjSize(photo_selection);if(e>0){f.slideDown();b.show();a("#select-count",b).html(e)}else{f.slideUp();b.hide();a("#select-count",b).html("0")}};havePhotosChanged=function(c){var d=a("#photos_hash").val(),b=getPhotosHash();if(b!=false&&d!=b){if(c==true){a("#photos_hash").val(b)}return true}return false};loadPhotosIframe=function(d){var c=a("#photo_iframe_overlay"),b=a("#loader",c);if(d==undefined){d=a("#photos_iframe").attr("src")}c.show();a("#photo_buttons").hide();b.css("top",((c.height()-b.outerHeight())/2)+c.scrollTop()+"px");b.css("left",((c.width()-b.outerWidth())/2)+c.scrollLeft()+"px");a("#photos_iframe").attr("src",d).fadeOut("fast")};showHidePhotoButtons=function(f){var c=a("#photos_iframe").contents().find("#photo_buttons");if(f==undefined){f=a("#photos_iframe").contents().find(".highlighted:first")}if(!a(f).length){c.hide();return}var e=a("img",f),d=a("#photo_iframe_overlay"),b=a("#loader",d);c.css("top",e.offset().top-d.scrollTop()+"px");c.css("left",e.offset().left-d.scrollLeft()+"px");c.show();a("#photo_edit_button",c).attr("href",a("#photo_iframe_edit_base").val()+"&id="+a(f).attr("id").replace("photo_","")+"&TB_iframe=true");a("#photo_del_button",c).attr("href","#"+a(f).attr("id").replace("photo_",""))};onPhotosIframeFinish=function(d){var c=a("#photos_iframe").contents().find("html,body"),b=a("#photo_container",c);var e=getAjaxData("paginate_links",{id:a("#edit_id").val(),base:a("#photos_iframe_base").val(),pp:a("#photos_per_page").val(),current:d});if(e!=false){a(".tablenav-pages").html(e);a(".tablenav-pages a").click(onPaginationClick)}a("#wp-word-count #photo-count").html(getPhotoCount());a(".photo",b).each(function(f){a(this).dblclick(onPhotoDoubleClick);a(this).click(onPhotoClick);if(photo_selection[a(this).attr("id")]==true){a(this).addClass("selected")}});c.click(onEmptyPhotoAreaClick);a("#photo_edit_button",c).click(onPhotoEditButtonClick);a("#photo_del_button",c).click(onPhotoDeleteButtonClick);c.keydown(onIframeKeyDown);removePhotosOverlay()};onDeleteSelected=function(d){if(a("#photo_del_is_perm").val()=="1"&&confirm(bgmL10n.warn_delete_all_photos)==false){return false}var b,c="";for(b in photo_selection){c+=b.replace("photo_","")+","}getAjaxData("delete_photos",c);showHideEditBar(true);if(havePhotosChanged(true)){loadPhotosIframe()}return false};onClearSelected=function(c){var b=a("#photos_iframe").contents().find("#photo_container");photo_selection=new Object();a(".photo",b).each(function(d){if(a(this).hasClass("selected")){a(this).removeClass("selected")}});showHideEditBar(false);return false};onPaginationClick=function(b){loadPhotosIframe(a(this).attr("href"));return false};onPhotoDoubleClick=function(b){var c=a(this).attr("id");a(this).toggleClass("selected");if(a(this).hasClass("selected")){photo_selection[c]=true}else{delete photo_selection[c]}showHideEditBar(false);return false};onPhotoClick=function(b){a("#photos_iframe").contents().find(".photo").removeClass("highlighted");a(this).addClass("highlighted");showHidePhotoButtons(this);return false};onEmptyPhotoAreaClick=function(b){a("#photos_iframe").contents().find(".photo").removeClass("highlighted");showHidePhotoButtons()};onPhotoEditButtonClick=function(b){tb_show(a(this).attr("title"),a(this).attr("href"));return false};onPhotoDeleteButtonClick=function(b){if(a("#photo_del_is_perm").val()=="1"&&confirm(bgmL10n.warn_delete_photo)==false){return false}getAjaxData("delete_photos",a(this).attr("href").replace("#",""));showHideEditBar(true);if(havePhotosChanged(true)){loadPhotosIframe()}return false};onIframeKeyDown=function(e){var f=a("#photos_iframe").contents().find("html,body"),c=a("#photo_container",f),d=a(".photo.highlighted",c);var b=function(h){if(!d.length&&h!=undefined){d=a(".photo:"+h,c).addClass("highlighted")}showHidePhotoButtons();if(f.length&&d.length){f.scrollTo(d)}};var g=function(h){return{x:a(h).offset().left,y:a(h).offset().top,w:a(h).outerWidth(),h:a(h).outerHeight()}};switch(e.keyCode){case 32:d.dblclick();return false;case 37:d=d.removeClass("highlighted").prev(".photo").addClass("highlighted");b("last");return false;case 39:d=d.removeClass("highlighted").next(".photo").addClass("highlighted");b("first");return false;case 40:if(d.length){d.removeClass("highlighted");possible_highlighted=a(".photo:below("+g(d).x+","+g(d).y+","+g(d).w+"):first",c);if(!possible_highlighted.length||possible_highlighted==d){d=a(".photo:above("+g(d).x+","+g(d).y+","+g(d).w+"):first",c);if(d.length){d=a(".photo:right("+g(d).x+","+g(d).y+","+g(d).h+"):first",c)}if(!d.length){d=a(".photo:first",c)}}else{d=possible_highlighted}d.addClass("highlighted");b()}else{b("last")}return false;case 38:if(d.length){d.removeClass("highlighted");possible_highlighted=a(".photo:above("+g(d).x+","+g(d).y+","+g(d).w+"):last",c);if(!possible_highlighted.length||possible_highlighted==d){if(d.prev(".photo").length){d=d.prev(".photo")}else{d=a(".photo:right("+g(d).x+","+g(d).y+","+g(d).h+"):last",c)}d=a(".photo:below("+g(d).x+","+g(d).y+","+g(d).w+"):last",c);if(!d.length){d=a(".photo:last",c)}}else{d=possible_highlighted}d.addClass("highlighted");b()}else{b("first")}return false}};a(document).ready(function(b){mainWin.send_to_editor=function(c){tb_remove()};mainWin.tb_remove=function(){b("#TB_imageOff").unbind("click");b("#TB_closeWindowButton").unbind("click");b("#TB_window").fadeOut("fast",function(){b("#TB_window,#TB_overlay,#TB_HideSelect").trigger("unload").unbind().remove()});b("#TB_load").remove();if(typeof document.body.style.maxHeight=="undefined"){b("body","html").css({height:"auto",width:"auto"});b("html").css("overflow","")}document.onkeydown="";document.onkeyup="";if(havePhotosChanged(true)){loadPhotosIframe()}return false};b("#ed_delete_selected").click(onDeleteSelected);b("#ed_clear_selected").click(onClearSelected)})})(jQuery);
