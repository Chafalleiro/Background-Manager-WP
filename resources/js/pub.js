/*!
 * Copyright (c) 2011-2012 Mike Green <myatus@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 */
if(typeof myatu_bgm==="undefined"){var myatu_bgm={}}(function(b){b.extend(myatu_bgm,{flux_transitions:["bars","zip","blinds","swipe","blocks","blocks2","concentric","warp"],image_holder:null,setTimer:function(){if(myatu_bgm.change_freq<=0){return}if(myatu_bgm.timer){clearTimeout(myatu_bgm.timer)}myatu_bgm.timer=setTimeout(myatu_bgm.switchBackground,myatu_bgm.change_freq*1000)},onBackgroundClick:function(a){if(a.target===this||b(a.target).hasClass("myatu_bgm_fs")){if(myatu_bgm.bg_click_new_window===true){window.open(a.data.url)}else{window.location.assign(a.data.url)}return false}},onBackgroundHover:function(a){b(this).css("cursor",(a.target===this||b(a.target).hasClass("myatu_bgm_fs"))?"pointer":"auto")},setBackgroundLink:function(a){var e=b("body");e.unbind("click",myatu_bgm.onBackgroundClick).unbind("mouseover",myatu_bgm.onBackgroundHover).css("cursor","auto");if(a!==""&&a!=="#"){e.bind("click",{url:a},myatu_bgm.onBackgroundClick).bind("mouseover",myatu_bgm.onBackgroundHover)}},urlReplaceQueryArgVal:function(g,f,a){var h=new RegExp("(?![?&])"+f+"=(.*?(?=\\?|\\&(?!amp;)|#|$))","ig");return g.replace(h,f+"="+encodeURIComponent(a))},onAnimationCompleted:function(){b("#myatu_bgm_prev").remove();myatu_bgm.setTimer();b(document).trigger("myatu_bgm_finish_transition")},AnimateSlide:function(m,t,a){var n=b("#myatu_bgm_top"),s=b("#myatu_bgm_prev"),q=n.offset(),v=s.offset(),r={},p,u,o;switch(m){case"top":u="top";r[u]=q.top+"px";o=n.height()-v.top;p="-"+o+"px";break;case"bottom":u="top";r[u]=q.top+"px";o=s.height()+v.top;p=o+"px";break;case"left":u="left";r[u]=q.left+"px";o=n.width()-v.left;p="-"+o+"px";break;case"right":u="left";r[u]=q.left+"px";o=s.width()+v.left;p=o+"px";break}n.css(u,p);n.show();if(typeof a==="undefined"||a===false){n.animate(r,{duration:t,complete:myatu_bgm.onAnimationCompleted,step:function(c,d){switch(m){case"top":s.css(u,(n.height()+c)+"px");break;case"bottom":s.css(u,(c-s.height())+"px");break;case"left":s.css(u,(n.width()+c)+"px");break;case"right":s.css(u,(c-s.width())+"px");break}}})}else{n.animate(r,{duration:t,complete:myatu_bgm.onAnimationCompleted})}},adjustImageSize:function(q){var m=(myatu_bgm.fs_center==="true"),o={left:0,top:0},a=b(window).height(),p=b(window).width(),n=p,r,l,k;if(myatu_bgm.is_fullsize!=="true"){return false}l=b(q).width()/b(q).height();r=n/l;if(r>=a){k=(r-a)/2;if(m){b.extend(o,{top:"-"+k+"px"})}}else{r=a;n=r*l;k=(n-p)/2;if(m){b.extend(o,{left:"-"+k+"px"})}}b(q).width(n).height(r).css(o);return true},loadImage:function(f,e){var a;if(myatu_bgm.image_holder===null){myatu_bgm.image_holder=b("<img />").css({position:"absolute",display:"none"}).appendTo("#myatu_bgm_img_group")}myatu_bgm.image_holder.css({width:"",height:""});myatu_bgm.image_holder.attr("src",f).imgLoaded(function(){myatu_bgm.adjustImageSize(this);if(typeof e==="function"){e()}})},onWindowResize:function(d){var a=myatu_bgm.image_holder;if(a===null){return}myatu_bgm.adjustImageSize(a);b("div#myatu_bgm_top").css("background-size",a.width()+"px "+a.height()+"px");b("#myatu_bgm_top").css({left:a.css("left"),top:a.css("top"),width:a.width()+"px",height:a.height()+"px"})},addTopImage:function(k,j,i,h){var l,a={display:"none"};myatu_bgm.loadImage(i,function(){if(myatu_bgm.Modernizr.backgroundsize){l=b("<div></div>");b.extend(a,{"background-image":"url("+i+")","background-size":myatu_bgm.image_holder.width()+"px "+myatu_bgm.image_holder.height()+"px","background-repeat":"no-repeat"})}else{l=myatu_bgm.image_holder.clone();l.attr("alt",j)}b.extend(a,{left:myatu_bgm.image_holder.css("left"),top:myatu_bgm.image_holder.css("top"),width:myatu_bgm.image_holder.width()+"px",height:myatu_bgm.image_holder.height()+"px"});l.attr({id:"myatu_bgm_top","class":"myatu_bgm_fs",style:k}).css(a).appendTo("#myatu_bgm_img_group");if(typeof h==="function"){h.call(l)}})},switchBackground:function(){var l=(myatu_bgm.is_fullsize==="true"),n=(myatu_bgm.is_preview==="true"),a=b("#myatu_bgm_info_tab"),p="",r,m,k,o,q;r=b((l)?"#myatu_bgm_top":"body").css("background-image").replace(/url\(|\)|"|'/g,"");if(r==="none"&&l){r=b("#myatu_bgm_top").attr("src")}if((l&&!b("#myatu_bgm_top").is(":visible"))){myatu_bgm.setTimer();return}if(n){o=myatu_bgm.image_selection}myatu_bgm.GetAjaxData("select_image",{prev_img:r,selector:o,active_gallery:myatu_bgm.active_gallery},function(d){if(!d||r===d.url){return}myatu_bgm.setBackgroundLink(d.bg_link);if(l){if(n){m=Number(myatu_bgm.transition_speed);k=myatu_bgm.active_transition;if(k==="random"){k=myatu_bgm.transitions[Math.floor(Math.random()*myatu_bgm.transitions.length)]}}else{m=d.transition_speed;k=d.transition}p=b("#myatu_bgm_top").attr("style");b("#myatu_bgm_top").attr("id","myatu_bgm_prev");myatu_bgm.addTopImage(p,d.alt,d.url,function(){var f=false;if(!b("#myatu_bgm_prev").length){k="none"}b(document).trigger("myatu_bgm_start_transition",[k,m,d]);if(myatu_bgm.Modernizr.backgroundsize){if(typeof q==="undefined"){q=new myatu_bgm_flux.slider("#myatu_bgm_img_group",{pagination:false,autoplay:false});b("#myatu_bgm_img_group").bind("fluxTransitionEnd",myatu_bgm.onAnimationCompleted)}}else{if(k!=="none"&&b.inArray(k,myatu_bgm.flux_transitions)>-1){k="";console.log("reset active transition")}}if(b.inArray(k,myatu_bgm.flux_transitions)>-1){m=m/50}switch(k){case"none":b(this).show();myatu_bgm.onAnimationCompleted();break;case"coverdown":f=true;case"slidedown":myatu_bgm.AnimateSlide("top",m,f);break;case"coverup":f=true;case"slideup":myatu_bgm.AnimateSlide("bottom",m,f);break;case"coverright":f=true;case"slideright":myatu_bgm.AnimateSlide("left",m,f);break;case"coverleft":f=true;case"slideleft":myatu_bgm.AnimateSlide("right",m,f);break;case"bars":case"blinds":case"zip":case"blocks":q.next(k,{delayBetweenBars:m});break;case"blocks2":q.next("blocks2",{delayBetweenDiagnols:m});break;case"swipe":case"concentric":case"warp":q.next(k);break;case"zoom":b("#myatu_bgm_prev").animate({opacity:0},{duration:m,queue:false});b(this).animate({width:b(this).width()*1.05,height:b(this).height()*1.05,opacity:"show"},{duration:m,complete:myatu_bgm.onAnimationCompleted});break;default:b("#myatu_bgm_prev").animate({opacity:0},{duration:m,queue:false});b(this).fadeIn(m,myatu_bgm.onAnimationCompleted);break}})}else{b("body").css("background-image",'url("'+d.url+'")');myatu_bgm.setTimer()}if(a.length){if(b.isFunction(a.qtip)){a.qtip("api").hide()}b(".myatu_bgm_info_tab a").attr("href",d.link);b(".myatu_bgm_info_tab_content.clonable img").attr("src",d.thumb);b(".myatu_bgm_info_tab_content.clonable h3").text(d.caption);b(".myatu_bgm_info_tab_content.clonable .myatu_bgm_info_tab_desc").html(d.desc)}if(b("#myatu_bgm_pin_it_btn").length){var e=b("#myatu_bgm_pin_it_btn iframe").attr("src"),c=d.desc.replace(/(<([^>]+)>)/ig,"");e=myatu_bgm.urlReplaceQueryArgVal(e,"media",d.url);e=myatu_bgm.urlReplaceQueryArgVal(e,"description",c);b("#myatu_bgm_pin_it_btn iframe").attr("src",e)}})},initInfoTab:function(){var a=b("#myatu_bgm_info_tab");if(!b.isFunction(a.qtip)||!a.length){return}a.qtip({content:{text:function(f){var e=b(".myatu_bgm_info_tab_content.clonable").clone();e.removeClass("clonable").addClass("shown");b("h3",e).remove();if(b(".myatu_bgm_info_tab_desc",e).text()===""){b("img",e).css("margin","5px 0")}else{b("img",e).css({width:"100px",height:"100px"});b(this).qtip("option","width",500)}return e},title:{text:function(d){return b(".myatu_bgm_info_tab_content.clonable h3").text()},button:true}},style:{classes:"ui-tooltip-bootstrap ui-tooltip-shadow ui-tooltip-rounded"},events:{hide:function(e,f){b(".myatu_bgm_info_tab_content.shown").remove()}},hide:false,position:{adjust:{x:-10},viewport:b(window)}})}});b(document).ready(function(d){var a=d("#myatu_bgm_bg_link");d(window).resize(myatu_bgm.onWindowResize);if(a.length){myatu_bgm.setBackgroundLink(a.attr("href"));a.remove()}myatu_bgm.initInfoTab();myatu_bgm.setTimer()})}(jQuery));