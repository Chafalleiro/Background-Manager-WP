/*!
 * Copyright (c) 2011-2012 Mike Green <myatus@gmail.com>
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 *
 */
if(myatu_bgm===undefined){var myatu_bgm={}}(function(a){a.extend(myatu_bgm,{SetTimer:function(){if(background_manager_vars.change_freq<=0){return}if(myatu_bgm.timer){clearTimeout(myatu_bgm.timer)}myatu_bgm.timer=setTimeout("myatu_bgm.SwitchBackground()",background_manager_vars.change_freq*1000)},OnBackgroundClick:function(b){if(b.target==this||a(b.target).hasClass("myatu_bgm_fs")){window.open(b.data.url);return false}},OnBackgroundHover:function(b){a(this).css("cursor",(b.target==this||a(b.target).hasClass("myatu_bgm_fs"))?"pointer":"auto")},SetBackgroundLink:function(d){var c=a("body");c.unbind("click",myatu_bgm.OnBackgroundClick).unbind("mouseover",myatu_bgm.OnBackgroundHover).css("cursor","auto");if(d!=""&&d!="#"){c.bind("click",{url:d},myatu_bgm.OnBackgroundClick).bind("mouseover",myatu_bgm.OnBackgroundHover)}},UrlReplaceQueryArgVal:function(d,e,b){var c=new RegExp("(?![?&])"+e+"=(.*?(?=\\?|\\&(?!amp;)|#|$))","ig");return d.replace(c,e+"="+encodeURIComponent(b))},AdjustImageSize:function(){var d=a("#myatu_bgm_top"),c=(background_manager_vars.fs_center=="true"),e={left:0,top:0},i=a(window).height(),b=win_width=a(window).width(),h,f,g;if(background_manager_vars.is_fullsize=="false"||background_manager_vars.fs_adjust=="false"){return}d.css({width:"",height:""});f=d.width()/d.height();h=b/f;if(h>=i){g=(h-i)/2;if(c){a.extend(e,{top:"-"+g+"px"})}}else{h=i;b=h*f;g=(b-win_width)/2;if(c){a.extend(e,{left:"-"+g+"px"})}}d.width(b).height(h).css(e)},AnimationCompleted:function(){a("#myatu_bgm_prev").remove();myatu_bgm.SetTimer()},AnimateSlide:function(j,d,k){var i=a("#myatu_bgm_top"),e=a("#myatu_bgm_prev"),g=i.offset(),b=e.offset(),f={},h,c;switch(j){case"top":c="top";f[c]=g.top+"px";pos=i.height()-b.top;h="-"+pos+"px";break;case"bottom":c="top";f[c]=g.top+"px";pos=e.height()+b.top;h=pos+"px";break;case"left":c="left";f[c]=g.left+"px";pos=i.width()-b.left;h="-"+pos+"px";break;case"right":c="left";f[c]=g.left+"px";pos=e.width()+b.left;h=pos+"px";break}i.css(c,h);i.css("visibility","");if(k===undefined||k===false){i.animate(f,{duration:d,complete:myatu_bgm.AnimationCompleted,step:function(l,m){switch(j){case"top":e.css(c,(i.height()+l)+"px");break;case"bottom":e.css(c,(l-e.height())+"px");break;case"left":e.css(c,(i.width()+l)+"px");break;case"right":e.css(c,(l-e.width())+"px");break}}})}else{i.animate(f,{duration:d,complete:myatu_bgm.AnimationCompleted})}},SwitchBackground:function(){var f=(background_manager_vars.is_fullsize=="true"),d=(background_manager_vars.is_preview=="true"),g=a("#myatu_bgm_info_tab"),c=(f)?a("#myatu_bgm_top").attr("src"):a("body").css("background-image"),b="",h,e;myatu_bgm.GetAjaxData("random_image",{prev_img:c,active_gallery:background_manager_vars.active_gallery},function(j){if(!j){return}myatu_bgm.SetBackgroundLink(j.bg_link);if(f){if(d){h=Number(background_manager_vars.transition_speed);e=background_manager_vars.active_transition;if(e=="random"){e=background_manager_vars.transitions[Math.floor(Math.random()*background_manager_vars.transitions.length)]}}else{h=j.transition_speed;e=j.transition}b=a("#myatu_bgm_top").attr("style");a("#myatu_bgm_top").attr("id","myatu_bgm_prev");a("<img>").attr({style:b,"class":"myatu_bgm_fs",id:"myatu_bgm_top",alt:j.alt}).css({visibility:"hidden",width:"",height:""}).appendTo("body");a("#myatu_bgm_top").attr("src",j.url).imgLoaded(function(){var l=false;myatu_bgm.AdjustImageSize();switch(e){case"none":a(this).css("visibility","");myatu_bgm.AnimationCompleted();break;case"coverdown":l=true;case"slidedown":myatu_bgm.AnimateSlide("top",h,l);break;case"coverup":l=true;case"slideup":myatu_bgm.AnimateSlide("bottom",h,l);break;case"coverright":l=true;case"slideright":myatu_bgm.AnimateSlide("left",h,l);break;case"coverleft":l=true;case"slideleft":myatu_bgm.AnimateSlide("right",h,l);break;default:a(this).css({display:"none",visibility:""});a("#myatu_bgm_prev").animate({opacity:0},{duration:h,queue:false});a(this).fadeIn(h,myatu_bgm.AnimationCompleted);break}})}else{a("body").css("background-image",'url("'+j.url+'")');myatu_bgm.SetTimer()}if(g.length){if(a.isFunction(g.qtip)){g.qtip("api").hide()}a(".myatu_bgm_info_tab a").attr("href",j.link);a(".myatu_bgm_info_tab_content img").attr("src",j.thumb);a(".myatu_bgm_info_tab_content h3").text(j.caption);a(".myatu_bgm_info_tab_desc").html(j.desc)}if(a("#myatu_bgm_pin_it_btn").length){var i=a("#myatu_bgm_pin_it_btn iframe").attr("src"),k=j.desc.replace(/(<([^>]+)>)/ig,"");i=myatu_bgm.UrlReplaceQueryArgVal(i,"media",j.url);i=myatu_bgm.UrlReplaceQueryArgVal(i,"description",k);a("#myatu_bgm_pin_it_btn iframe").attr("src",i)}})}});a(document).ready(function(c){var b=c("#myatu_bgm_bg_link"),d=c("#myatu_bgm_info_tab");myatu_bgm.SetTimer();c(window).resize(function(){myatu_bgm.AdjustImageSize()});if(b.length){myatu_bgm.SetBackgroundLink(b.attr("href"));b.remove()}if(c.isFunction(d.qtip)){d.qtip({content:{text:function(e){var f=c(".myatu_bgm_info_tab_content").clone();c("h3",f).remove();if(c(".myatu_bgm_info_tab_desc",f).text()===""){c("img",f).css("margin",0)}else{c("img",f).css({width:"100px",height:"100px"})}return f},title:{text:function(e){return c(".myatu_bgm_info_tab_content:first h3").text()},button:true}},style:{classes:"ui-tooltip-dark ui-tooltip-shadow"},events:{hide:function(f,e){c(".myatu_bgm_info_tab_content:last").remove()}},hide:false,position:{adjust:{x:-10},viewport:c(window)}})}})})(jQuery);
